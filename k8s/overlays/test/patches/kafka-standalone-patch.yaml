# 테스트 환경 Kafka 단일 브로커 설정
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: kafka
  namespace: shop-msa
spec:
  replicas: 1
  template:
    spec:
      containers:
      - name: kafka
        env:
        # 브로커 ID
        - name: KAFKA_BROKER_ID
          value: "0"
        # Zookeeper 연결 (단일 노드)
        - name: KAFKA_ZOOKEEPER_CONNECT
          value: "zookeeper-0.zookeeper-headless.shop-msa.svc.cluster.local:2181"
        # 리스너 설정
        - name: KAFKA_LISTENERS
          value: "PLAINTEXT://:9092"
        - name: KAFKA_ADVERTISED_LISTENERS
          value: "PLAINTEXT://kafka-0.kafka-headless.shop-msa.svc.cluster.local:9092"
        # 단일 브로커 설정 - 복제 계수 1
        - name: KAFKA_DEFAULT_REPLICATION_FACTOR
          value: "1"
        - name: KAFKA_MIN_INSYNC_REPLICAS
          value: "1"
        - name: KAFKA_NUM_PARTITIONS
          value: "1"
        - name: KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR
          value: "1"
        - name: KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR
          value: "1"
        - name: KAFKA_TRANSACTION_STATE_LOG_MIN_ISR
          value: "1"
        # 로그 설정
        - name: KAFKA_LOG_DIRS
          value: "/var/lib/kafka/data"
        - name: KAFKA_LOG_RETENTION_HOURS
          value: "168"
        # 자동 토픽 생성
        - name: KAFKA_AUTO_CREATE_TOPICS_ENABLE
          value: "true"
        # JVM 힙 설정 (테스트 환경 - 낮춤)
        - name: KAFKA_HEAP_OPTS
          value: "-Xmx512M -Xms512M"
