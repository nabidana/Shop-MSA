apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Base 참조
# bases:
#   - ../../base

# 테스트 환경 레이블 추가
# commonLabels:
#   environment: test

# 네임스페이스 (선택사항 - 별도 네임스페이스 사용 시)
# namespace: shop-msa

# 애플리케이션 서비스는 제외하고 인프라만 배포
# Base의 리소스 중 필요한 것만 선택적으로 포함
# components:
  # - infrastructure-only.yaml
resources:
# 네임스페이스
  - ../../base/infrastructure

labels:
  - pairs:
      environment: test

# 테스트 환경 패치 적용
patches:
  - path: patches/replica-patch.yaml
  - path: patches/resource-patch.yaml
  - path: patches/storage-patch.yaml
  - path: patches/postgre-secret.yaml
  - path: patches/zookeeper-standalone-patch.yaml
  - path: patches/kafka-standalone-patch.yaml

# ConfigMap 생성 (테스트 환경 설정)
configMapGenerator:
  - name: app-config
    literals:
      - SPRING_PROFILES_ACTIVE=test
      - LOG_LEVEL=DEBUG

# Secret 생성 (테스트 환경용)
# secretGenerator:
#   - name: postgres-secret
#     behavior: merge
#     literals:
#       - postgres-password=test_postgres_password
#       - userservice-password=test_user_password
#       - paymentservice-password=test_payment_password
#       - settlementservice-password=test_settlement_password
#       - partnerservice-password=test_partner_password
#       - accountingservice-password=test_accounting_password
