apiVersion: v1
kind: ConfigMap
metadata:
  name: redis-config
  namespace: shop-msa
  labels:
    app: redis
data:
  # Redis Master 설정
  redis-master.conf: |
    # 네트워크 설정
    bind 0.0.0.0
    port 6379
    
    # 보안 설정 (환경별로 오버라이드 필요)
    # requirepass yourpassword
    
    # 데이터 지속성 설정
    save 900 1
    save 300 10
    save 60 10000
    
    # AOF 설정
    appendonly yes
    appendfilename "appendonly.aof"
    
    # 로깅
    loglevel notice
    
  # Redis Sentinel 설정
  redis-sentinel.conf: |
    # Sentinel 포트
    port 26379
    
    # Master 모니터링 설정
    sentinel monitor mymaster redis-master-0.redis-master-headless.shop-msa.svc.cluster.local 6379 2
    
    # Master 다운 판단 시간 (밀리초)
    sentinel down-after-milliseconds mymaster 5000
    
    # Failover 타임아웃
    sentinel failover-timeout mymaster 10000
    
    # 병렬 동기화 수
    sentinel parallel-syncs mymaster 1
    
    # Sentinel 보안 설정
    # sentinel auth-pass mymaster yourpassword
