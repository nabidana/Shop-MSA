apiVersion: v1
kind: ConfigMap
metadata:
  name: redis-config
data:
  # Redis Master 설정
  master.conf: |
    bind 0.0.0.0
    port 6379
    # 데이터 영속성 설정
    save 900 1
    save 300 10
    save 60 10000
    # AOF 설정
    appendonly yes
    appendfsync everysec
    # 메모리 설정
    maxmemory 512mb
    maxmemory-policy allkeys-lru
    # 보안 설정 (환경별로 오버라이드)
    requirepass changeme

  # Redis Slave 설정
  slave.conf: |
    bind 0.0.0.0
    port 6379
    slaveof redis-master 6379
    masterauth changeme
    # 데이터 영속성 설정
    save 900 1
    save 300 10
    save 60 10000
    appendonly yes
    appendfsync everysec
    maxmemory 512mb
    maxmemory-policy allkeys-lru
    requirepass changeme

  # Redis Sentinel 설정
  sentinel.conf: |
    bind 0.0.0.0
    port 26379
    # Master 모니터링 설정
    sentinel monitor mymaster redis-master 6379 2
    sentinel auth-pass mymaster changeme
    # Failover 설정
    sentinel down-after-milliseconds mymaster 5000
    sentinel parallel-syncs mymaster 1
    sentinel failover-timeout mymaster 10000
    # Sentinel 인증 (선택사항)
    # requirepass changeme
